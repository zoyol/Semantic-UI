!function($,e,n,o){"use strict";e="undefined"!=typeof e&&e.Math==Math?e:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),$.fn.visibility=function(t){var i=$(this),s=i.selector||"",c=(new Date).getTime(),r=[],a=arguments[0],l="string"==typeof a,d=[].slice.call(arguments,1),u,f=i.length,b=0;return i.each(function(){var i=$.isPlainObject(t)?$.extend(!0,{},$.fn.visibility.settings,t):$.extend({},$.fn.visibility.settings),m=i.className,g=i.namespace,p=i.error,v=i.metadata,h="."+g,P="module-"+g,x=$(e),C=$(this),y=$(i.context),R,V=C.selector||"",S=C.data(P),k=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,0)},T=this,O=!1,A,z,w;w={initialize:function(){w.debug("Initializing",i),w.setup.cache(),w.should.trackChanges()&&("image"==i.type&&w.setup.image(),"fixed"==i.type&&w.setup.fixed(),i.observeChanges&&w.observeChanges(),w.bind.events()),w.save.position(),w.is.visible()||w.error(p.visible,C),i.initialCheck&&w.checkVisibility(),w.instantiate()},instantiate:function(){w.debug("Storing instance",w),C.data(P,w),S=w},destroy:function(){w.verbose("Destroying previous module"),z&&z.disconnect(),A&&A.disconnect(),x.off("load"+h,w.event.load).off("resize"+h,w.event.resize),y.off("scroll"+h,w.event.scroll).off("scrollchange"+h,w.event.scrollchange),"fixed"==i.type&&(w.resetFixed(),w.remove.placeholder()),C.off(h).removeData(P)},observeChanges:function(){"MutationObserver"in e&&(A=new MutationObserver(w.event.contextChanged),z=new MutationObserver(w.event.changed),A.observe(n,{childList:!0,subtree:!0}),z.observe(T,{childList:!0,subtree:!0}),w.debug("Setting up mutation observer",z))},bind:{events:function(){w.verbose("Binding visibility events to scroll and resize"),i.refreshOnLoad&&x.on("load"+h,w.event.load),x.on("resize"+h,w.event.resize),y.off("scroll"+h).on("scroll"+h,w.event.scroll).on("scrollchange"+h,w.event.scrollchange)}},event:{changed:function(e){w.verbose("DOM tree modified, updating visibility calculations"),w.timer=setTimeout(function(){w.verbose("DOM tree modified, updating sticky menu"),w.refresh()},100)},contextChanged:function(e){[].forEach.call(e,function(e){e.removedNodes&&[].forEach.call(e.removedNodes,function(e){(e==T||$(e).find(T).length>0)&&(w.debug("Element removed from DOM, tearing down events"),w.destroy())})})},resize:function(){w.debug("Window resized"),i.refreshOnResize&&k(w.refresh)},load:function(){w.debug("Page finished loading"),k(w.refresh)},scroll:function(){i.throttle?(clearTimeout(w.timer),w.timer=setTimeout(function(){y.triggerHandler("scrollchange"+h,[y.scrollTop()])},i.throttle)):k(function(){y.triggerHandler("scrollchange"+h,[y.scrollTop()])})},scrollchange:function(e,n){w.checkVisibility(n)}},precache:function(e,o){e instanceof Array||(e=[e]);for(var t=e.length,i=0,s=[],c=n.createElement("img"),r=function(){i++,i>=e.length&&$.isFunction(o)&&o()};t--;)c=n.createElement("img"),c.onload=r,c.onerror=r,c.src=e[t],s.push(c)},enableCallbacks:function(){w.debug("Allowing callbacks to occur"),O=!1},disableCallbacks:function(){w.debug("Disabling all callbacks temporarily"),O=!0},should:{trackChanges:function(){return l?(w.debug("One time query, no need to bind events"),!1):(w.debug("Callbacks being attached"),!0)}},setup:{cache:function(){w.cache={occurred:{},screen:{},element:{}}},image:function(){var e=C.data(v.src);e&&(w.verbose("Lazy loading image",e),i.once=!0,i.observeChanges=!1,i.onOnScreen=function(){w.debug("Image on screen",T),w.precache(e,function(){w.set.image(e,function(){b++,b==f&&i.onAllLoaded.call(this),i.onLoad.call(this)})})})},fixed:function(){w.debug("Setting up fixed"),i.once=!1,i.observeChanges=!1,i.initialCheck=!0,i.refreshOnLoad=!0,t.transition||(i.transition=!1),w.create.placeholder(),w.debug("Added placeholder",R),i.onTopPassed=function(){w.debug("Element passed, adding fixed position",C),w.show.placeholder(),w.set.fixed(),i.transition&&$.fn.transition!==o&&C.transition(i.transition,i.duration)},i.onTopPassedReverse=function(){w.debug("Element returned to position, removing fixed",C),w.hide.placeholder(),w.remove.fixed()}}},create:{placeholder:function(){w.verbose("Creating fixed position placeholder"),R=C.clone(!1).css("display","none").addClass(m.placeholder).insertAfter(C)}},show:{placeholder:function(){w.verbose("Showing placeholder"),R.css("display","block").css("visibility","hidden")}},hide:{placeholder:function(){w.verbose("Hiding placeholder"),R.css("display","none").css("visibility","")}},set:{fixed:function(){w.verbose("Setting element to fixed position"),C.addClass(m.fixed).css({position:"fixed",top:i.offset+"px",left:"auto",zIndex:i.zIndex}),i.onFixed.call(T)},image:function(e,n){C.attr("src",e),i.transition?$.fn.transition!==o?C.transition(i.transition,i.duration,n):C.fadeIn(i.duration,n):C.show()}},is:{onScreen:function(){var e=w.get.elementCalculations();return e.onScreen},offScreen:function(){var e=w.get.elementCalculations();return e.offScreen},visible:function(){return!(!w.cache||!w.cache.element)&&!(0===w.cache.element.width&&0===w.cache.element.offset.top)}},refresh:function(){w.debug("Refreshing constants (width/height)"),"fixed"==i.type&&w.resetFixed(),w.reset(),w.save.position(),i.checkOnRefresh&&w.checkVisibility(),i.onRefresh.call(T)},resetFixed:function(){w.remove.fixed(),w.remove.occurred()},reset:function(){w.verbose("Resetting all cached values"),$.isPlainObject(w.cache)&&(w.cache.screen={},w.cache.element={})},checkVisibility:function(e){w.verbose("Checking visibility of element",w.cache.element),!O&&w.is.visible()&&(w.save.scroll(e),w.save.calculations(),w.passed(),w.passingReverse(),w.topVisibleReverse(),w.bottomVisibleReverse(),w.topPassedReverse(),w.bottomPassedReverse(),w.onScreen(),w.offScreen(),w.passing(),w.topVisible(),w.bottomVisible(),w.topPassed(),w.bottomPassed(),i.onUpdate&&i.onUpdate.call(T,w.get.elementCalculations()))},passed:function(e,n){var t=w.get.elementCalculations(),s;if(e&&n)i.onPassed[e]=n;else{if(e!==o)return w.get.pixelsPassed(e)>t.pixelsPassed;t.passing&&$.each(i.onPassed,function(e,n){t.bottomVisible||t.pixelsPassed>w.get.pixelsPassed(e)?w.execute(n,e):i.once||w.remove.occurred(n)})}},onScreen:function(e){var n=w.get.elementCalculations(),t=e||i.onOnScreen,s="onScreen";if(e&&(w.debug("Adding callback for onScreen",e),i.onOnScreen=e),n.onScreen?w.execute(t,s):i.once||w.remove.occurred(s),e!==o)return n.onOnScreen},offScreen:function(e){var n=w.get.elementCalculations(),t=e||i.onOffScreen,s="offScreen";if(e&&(w.debug("Adding callback for offScreen",e),i.onOffScreen=e),n.offScreen?w.execute(t,s):i.once||w.remove.occurred(s),e!==o)return n.onOffScreen},passing:function(e){var n=w.get.elementCalculations(),t=e||i.onPassing,s="passing";if(e&&(w.debug("Adding callback for passing",e),i.onPassing=e),n.passing?w.execute(t,s):i.once||w.remove.occurred(s),e!==o)return n.passing},topVisible:function(e){var n=w.get.elementCalculations(),t=e||i.onTopVisible,s="topVisible";if(e&&(w.debug("Adding callback for top visible",e),i.onTopVisible=e),n.topVisible?w.execute(t,s):i.once||w.remove.occurred(s),e===o)return n.topVisible},bottomVisible:function(e){var n=w.get.elementCalculations(),t=e||i.onBottomVisible,s="bottomVisible";if(e&&(w.debug("Adding callback for bottom visible",e),i.onBottomVisible=e),n.bottomVisible?w.execute(t,s):i.once||w.remove.occurred(s),e===o)return n.bottomVisible},topPassed:function(e){var n=w.get.elementCalculations(),t=e||i.onTopPassed,s="topPassed";if(e&&(w.debug("Adding callback for top passed",e),i.onTopPassed=e),n.topPassed?w.execute(t,s):i.once||w.remove.occurred(s),e===o)return n.topPassed},bottomPassed:function(e){var n=w.get.elementCalculations(),t=e||i.onBottomPassed,s="bottomPassed";if(e&&(w.debug("Adding callback for bottom passed",e),i.onBottomPassed=e),n.bottomPassed?w.execute(t,s):i.once||w.remove.occurred(s),e===o)return n.bottomPassed},passingReverse:function(e){var n=w.get.elementCalculations(),t=e||i.onPassingReverse,s="passingReverse";if(e&&(w.debug("Adding callback for passing reverse",e),i.onPassingReverse=e),n.passing?i.once||w.remove.occurred(s):w.get.occurred("passing")&&w.execute(t,s),e!==o)return!n.passing},topVisibleReverse:function(e){var n=w.get.elementCalculations(),t=e||i.onTopVisibleReverse,s="topVisibleReverse";if(e&&(w.debug("Adding callback for top visible reverse",e),i.onTopVisibleReverse=e),n.topVisible?i.once||w.remove.occurred(s):w.get.occurred("topVisible")&&w.execute(t,s),e===o)return!n.topVisible},bottomVisibleReverse:function(e){var n=w.get.elementCalculations(),t=e||i.onBottomVisibleReverse,s="bottomVisibleReverse";if(e&&(w.debug("Adding callback for bottom visible reverse",e),i.onBottomVisibleReverse=e),n.bottomVisible?i.once||w.remove.occurred(s):w.get.occurred("bottomVisible")&&w.execute(t,s),e===o)return!n.bottomVisible},topPassedReverse:function(e){var n=w.get.elementCalculations(),t=e||i.onTopPassedReverse,s="topPassedReverse";if(e&&(w.debug("Adding callback for top passed reverse",e),i.onTopPassedReverse=e),n.topPassed?i.once||w.remove.occurred(s):w.get.occurred("topPassed")&&w.execute(t,s),e===o)return!n.onTopPassed},bottomPassedReverse:function(e){var n=w.get.elementCalculations(),t=e||i.onBottomPassedReverse,s="bottomPassedReverse";if(e&&(w.debug("Adding callback for bottom passed reverse",e),i.onBottomPassedReverse=e),n.bottomPassed?i.once||w.remove.occurred(s):w.get.occurred("bottomPassed")&&w.execute(t,s),e===o)return!n.bottomPassed},execute:function(e,n){var o=w.get.elementCalculations(),t=w.get.screenCalculations();e=e||!1,e&&(i.continuous?(w.debug("Callback being called continuously",n,o),e.call(T,o,t)):w.get.occurred(n)||(w.debug("Conditions met",n,o),e.call(T,o,t))),w.save.occurred(n)},remove:{fixed:function(){w.debug("Removing fixed position"),C.removeClass(m.fixed).css({position:"",top:"",left:"",zIndex:""}),i.onUnfixed.call(T)},placeholder:function(){w.debug("Removing placeholder content"),R&&R.remove()},occurred:function(e){if(e){var n=w.cache.occurred;n[e]!==o&&n[e]===!0&&(w.debug("Callback can now be called again",e),w.cache.occurred[e]=!1)}else w.cache.occurred={}}},save:{calculations:function(){w.verbose("Saving all calculations necessary to determine positioning"),w.save.direction(),w.save.screenCalculations(),w.save.elementCalculations()},occurred:function(e){e&&(w.cache.occurred[e]!==o&&w.cache.occurred[e]===!0||(w.verbose("Saving callback occurred",e),w.cache.occurred[e]=!0))},scroll:function(e){e=e+i.offset||y.scrollTop()+i.offset,w.cache.scroll=e},direction:function(){var e=w.get.scroll(),n=w.get.lastScroll(),o;return o=e>n&&n?"down":e<n&&n?"up":"static",w.cache.direction=o,w.cache.direction},elementPosition:function(){var e=w.cache.element,n=w.get.screenSize();return w.verbose("Saving element position"),e.fits=e.height<n.height,e.offset=C.offset(),e.width=C.outerWidth(),e.height=C.outerHeight(),w.cache.element=e,e},elementCalculations:function(){var e=w.get.screenCalculations(),n=w.get.elementPosition();return i.includeMargin?(n.margin={},n.margin.top=parseInt(C.css("margin-top"),10),n.margin.bottom=parseInt(C.css("margin-bottom"),10),n.top=n.offset.top-n.margin.top,n.bottom=n.offset.top+n.height+n.margin.bottom):(n.top=n.offset.top,n.bottom=n.offset.top+n.height),n.topVisible=e.bottom>=n.top,n.topPassed=e.top>=n.top,n.bottomVisible=e.bottom>=n.bottom,n.bottomPassed=e.top>=n.bottom,n.pixelsPassed=0,n.percentagePassed=0,n.onScreen=n.topVisible&&!n.bottomPassed,n.passing=n.topPassed&&!n.bottomPassed,n.offScreen=!n.onScreen,n.passing&&(n.pixelsPassed=e.top-n.top,n.percentagePassed=(e.top-n.top)/n.height),w.cache.element=n,w.verbose("Updated element calculations",n),n},screenCalculations:function(){var e=w.get.scroll();return w.save.direction(),w.cache.screen.top=e,w.cache.screen.bottom=e+w.cache.screen.height,w.cache.screen},screenSize:function(){w.verbose("Saving window position"),w.cache.screen={height:y.height()}},position:function(){w.save.screenSize(),w.save.elementPosition()}},get:{pixelsPassed:function(e){var n=w.get.elementCalculations();return e.search("%")>-1?n.height*(parseInt(e,10)/100):parseInt(e,10)},occurred:function(e){return w.cache.occurred!==o&&(w.cache.occurred[e]||!1)},direction:function(){return w.cache.direction===o&&w.save.direction(),w.cache.direction},elementPosition:function(){return w.cache.element===o&&w.save.elementPosition(),w.cache.element},elementCalculations:function(){return w.cache.element===o&&w.save.elementCalculations(),w.cache.element},screenCalculations:function(){return w.cache.screen===o&&w.save.screenCalculations(),w.cache.screen},screenSize:function(){return w.cache.screen===o&&w.save.screenSize(),w.cache.screen},scroll:function(){return w.cache.scroll===o&&w.save.scroll(),w.cache.scroll},lastScroll:function(){return w.cache.screen===o?(w.debug("First scroll event, no last scroll could be found"),!1):w.cache.screen.top}},setting:function(e,n){if($.isPlainObject(e))$.extend(!0,i,e);else{if(n===o)return i[e];i[e]=n}},internal:function(e,n){if($.isPlainObject(e))$.extend(!0,w,e);else{if(n===o)return w[e];w[e]=n}},debug:function(){!i.silent&&i.debug&&(i.performance?w.performance.log(arguments):(w.debug=Function.prototype.bind.call(console.info,console,i.name+":"),w.debug.apply(console,arguments)))},verbose:function(){!i.silent&&i.verbose&&i.debug&&(i.performance?w.performance.log(arguments):(w.verbose=Function.prototype.bind.call(console.info,console,i.name+":"),w.verbose.apply(console,arguments)))},error:function(){i.silent||(w.error=Function.prototype.bind.call(console.error,console,i.name+":"),w.error.apply(console,arguments))},performance:{log:function(e){var n,o,t;i.performance&&(n=(new Date).getTime(),t=c||n,o=n-t,c=n,r.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:T,"Execution Time":o})),clearTimeout(w.performance.timer),w.performance.timer=setTimeout(w.performance.display,500)},display:function(){var e=i.name+":",n=0;c=!1,clearTimeout(w.performance.timer),$.each(r,function(e,o){n+=o["Execution Time"]}),e+=" "+n+"ms",s&&(e+=" '"+s+"'"),(console.group!==o||console.table!==o)&&r.length>0&&(console.groupCollapsed(e),console.table?console.table(r):$.each(r,function(e,n){console.log(n.Name+": "+n["Execution Time"]+"ms")}),console.groupEnd()),r=[]}},invoke:function(e,n,t){var i=S,s,c,r;return n=n||d,t=T||t,"string"==typeof e&&i!==o&&(e=e.split(/[\. ]/),s=e.length-1,$.each(e,function(n,t){var r=n!=s?t+e[n+1].charAt(0).toUpperCase()+e[n+1].slice(1):e;if($.isPlainObject(i[r])&&n!=s)i=i[r];else{if(i[r]!==o)return c=i[r],!1;if(!$.isPlainObject(i[t])||n==s)return i[t]!==o?(c=i[t],!1):(w.error(p.method,e),!1);i=i[t]}})),$.isFunction(c)?r=c.apply(t,n):c!==o&&(r=c),$.isArray(u)?u.push(r):u!==o?u=[u,r]:r!==o&&(u=r),c}},l?(S===o&&w.initialize(),S.save.scroll(),S.save.calculations(),w.invoke(a)):(S!==o&&S.invoke("destroy"),w.initialize())}),u!==o?u:this},$.fn.visibility.settings={name:"Visibility",namespace:"visibility",debug:!1,verbose:!1,performance:!0,observeChanges:!0,initialCheck:!0,refreshOnLoad:!0,refreshOnResize:!0,checkOnRefresh:!0,once:!0,continuous:!1,offset:0,includeMargin:!1,context:e,throttle:!1,type:!1,zIndex:"10",transition:"fade in",duration:1e3,onPassed:{},onOnScreen:!1,onOffScreen:!1,onPassing:!1,onTopVisible:!1,onBottomVisible:!1,onTopPassed:!1,onBottomPassed:!1,onPassingReverse:!1,onTopVisibleReverse:!1,onBottomVisibleReverse:!1,onTopPassedReverse:!1,onBottomPassedReverse:!1,onLoad:function(){},onAllLoaded:function(){},onFixed:function(){},onUnfixed:function(){},onUpdate:!1,onRefresh:function(){},metadata:{src:"src"},className:{fixed:"fixed",placeholder:"placeholder"},error:{method:"The method you called is not defined.",visible:"Element is hidden, you must call refresh after element becomes visible"}}}(jQuery,window,document);