!function($,e,t,s){"use strict";e="undefined"!=typeof e&&e.Math==Math?e:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),$.fn.search=function(n){var r=$(this),i=r.selector||"",a=(new Date).getTime(),o=[],c=arguments[0],u="string"==typeof c,l=[].slice.call(arguments,1),d;return $(this).each(function(){var f=$.isPlainObject(n)?$.extend(!0,{},$.fn.search.settings,n):$.extend({},$.fn.search.settings),g=f.className,h=f.metadata,p=f.regExp,v=f.fields,m=f.selector,b=f.error,y=f.namespace,R="."+y,C=y+"-module",w=$(this),x=w.find(m.prompt),j=w.find(m.searchButton),k=w.find(m.results),A=w.find(m.result),E=w.find(m.category),q=this,F=w.data(C),S=!1,T;T={initialize:function(){T.verbose("Initializing module"),T.determine.searchFields(),T.bind.events(),T.set.type(),T.create.results(),T.instantiate()},instantiate:function(){T.verbose("Storing instance of module",T),F=T,w.data(C,T)},destroy:function(){T.verbose("Destroying instance"),w.off(R).removeData(C)},refresh:function(){T.debug("Refreshing selector cache"),x=w.find(m.prompt),j=w.find(m.searchButton),E=w.find(m.category),k=w.find(m.results),A=w.find(m.result)},refreshResults:function(){k=w.find(m.results),A=w.find(m.result)},bind:{events:function(){T.verbose("Binding events to search"),f.automatic&&(w.on(T.get.inputEvent()+R,m.prompt,T.event.input),x.attr("autocomplete","off")),w.on("focus"+R,m.prompt,T.event.focus).on("blur"+R,m.prompt,T.event.blur).on("keydown"+R,m.prompt,T.handleKeyboard).on("click"+R,m.searchButton,T.query).on("mousedown"+R,m.results,T.event.result.mousedown).on("mouseup"+R,m.results,T.event.result.mouseup).on("click"+R,m.result,T.event.result.click)}},determine:{searchFields:function(){n&&n.searchFields!==s&&(f.searchFields=n.searchFields)}},event:{input:function(){clearTimeout(T.timer),T.timer=setTimeout(T.query,f.searchDelay)},focus:function(){T.set.focus(),T.has.minimumCharacters()&&(T.query(),T.can.show()&&T.showResults())},blur:function(e){var s=t.activeElement===this,n=function(){T.cancel.query(),T.remove.focus(),T.timer=setTimeout(T.hideResults,f.hideDelay)};s||(T.resultsClicked?(T.debug("Determining if user action caused search to close"),w.one("click.close"+R,m.results,function(e){return T.is.inMessage(e)||S?void x.focus():(S=!1,void(T.is.animating()||T.is.hidden()||n()))})):(T.debug("Input blurred without user action, closing results"),n()))},result:{mousedown:function(){T.resultsClicked=!0},mouseup:function(){T.resultsClicked=!1},click:function(t){T.debug("Search result selected");var s=$(this),n=s.find(m.title).eq(0),r=s.is("a[href]")?s:s.find("a[href]").eq(0),i=r.attr("href")||!1,a=r.attr("target")||!1,o=n.html(),c=n.length>0&&n.text(),u=T.get.results(),l=s.data(h.result)||T.get.result(c,u),d;return $.isFunction(f.onSelect)&&f.onSelect.call(q,l,u)===!1?(T.debug("Custom onSelect callback cancelled default select action"),void(S=!0)):(T.hideResults(),c&&T.set.value(c),void(i&&(T.verbose("Opening search link found in result",r),"_blank"==a||t.ctrlKey?e.open(i):e.location.href=i)))}}},handleKeyboard:function(e){var t=w.find(m.result),s=w.find(m.category),n=t.filter("."+g.active),r=t.index(n),i=t.length,a=n.length>0,o=e.which,c={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40},u;if(o==c.escape&&(T.verbose("Escape key pressed, blurring search field"),T.trigger.blur()),T.is.visible())if(o==c.enter){if(T.verbose("Enter key pressed, selecting active result"),t.filter("."+g.active).length>0)return T.event.result.click.call(t.filter("."+g.active),e),e.preventDefault(),!1}else o==c.upArrow&&a?(T.verbose("Up key pressed, changing active result"),u=r-1<0?r:r-1,s.removeClass(g.active),t.removeClass(g.active).eq(u).addClass(g.active).closest(s).addClass(g.active),e.preventDefault()):o==c.downArrow&&(T.verbose("Down key pressed, changing active result"),u=r+1>=i?r:r+1,s.removeClass(g.active),t.removeClass(g.active).eq(u).addClass(g.active).closest(s).addClass(g.active),e.preventDefault());else o==c.enter&&(T.verbose("Enter key pressed, executing query"),T.query(),T.set.buttonPressed(),x.one("keyup",T.remove.buttonFocus))},setup:{api:function(e){var t={debug:f.debug,on:!1,cache:!0,action:"search",urlData:{query:e},onSuccess:function(t){T.parse.response.call(q,t,e)},onAbort:function(e){},onFailure:function(){T.displayMessage(b.serverError)},onError:T.error},s;$.extend(!0,t,f.apiSettings),T.verbose("Setting up API request",t),w.api(t)}},can:{useAPI:function(){return $.fn.api!==s},show:function(){return T.is.focused()&&!T.is.visible()&&!T.is.empty()},transition:function(){return f.transition&&$.fn.transition!==s&&w.transition("is supported")}},is:{animating:function(){return k.hasClass(g.animating)},hidden:function(){return k.hasClass(g.hidden)},inMessage:function(e){if(e.target){var s=$(e.target),n=$.contains(t.documentElement,e.target);return n&&s.closest(m.message).length>0}},empty:function(){return""===k.html()},visible:function(){return k.filter(":visible").length>0},focused:function(){return x.filter(":focus").length>0}},trigger:{blur:function(){var e=t.createEvent("HTMLEvents"),s=x[0];s&&(T.verbose("Triggering native blur event"),e.initEvent("blur",!1,!1),s.dispatchEvent(e))}},get:{inputEvent:function(){var e=x[0],t=e!==s&&e.oninput!==s?"input":e!==s&&e.onpropertychange!==s?"propertychange":"keyup";return t},value:function(){return x.val()},results:function(){var e=w.data(h.results);return e},result:function(e,t){var n=["title","id"],r=!1;return e=e!==s?e:T.get.value(),t=t!==s?t:T.get.results(),"category"===f.type?(T.debug("Finding result that matches",e),$.each(t,function(t,s){if($.isArray(s.results)&&(r=T.search.object(e,s.results,n)[0]))return!1})):(T.debug("Finding result in results object",e),r=T.search.object(e,t,n)[0]),r||!1}},select:{firstResult:function(){T.verbose("Selecting first result"),A.first().addClass(g.active)}},set:{focus:function(){w.addClass(g.focus)},loading:function(){w.addClass(g.loading)},value:function(e){T.verbose("Setting search input value",e),x.val(e)},type:function(e){e=e||f.type,"category"==f.type&&w.addClass(f.type)},buttonPressed:function(){j.addClass(g.pressed)}},remove:{loading:function(){w.removeClass(g.loading)},focus:function(){w.removeClass(g.focus)},buttonPressed:function(){j.removeClass(g.pressed)}},query:function(){var e=T.get.value(),t=T.read.cache(e);T.has.minimumCharacters()?(t?(T.debug("Reading result from cache",e),T.save.results(t.results),T.addResults(t.html),T.inject.id(t.results)):(T.debug("Querying for",e),$.isPlainObject(f.source)||$.isArray(f.source)?T.search.local(e):T.can.useAPI()?T.search.remote(e):T.error(b.source)),f.onSearchQuery.call(q,e)):T.hideResults()},search:{local:function(e){var t=T.search.object(e,f.content),s;T.set.loading(),T.save.results(t),T.debug("Returned local search results",t),s=T.generateResults({results:t}),T.remove.loading(),T.addResults(s),T.inject.id(t),T.write.cache(e,{html:s,results:t})},remote:function(e){w.api("is loading")&&w.api("abort"),T.setup.api(e),w.api("query")},object:function(e,t,n){var r=[],i=[],a=e.toString().replace(p.escape,"\\$&"),o=new RegExp(p.beginsWith+a,"i"),c=function(e,t){var s=$.inArray(t,r)==-1,n=$.inArray(t,i)==-1;s&&n&&e.push(t)};return t=t||f.source,n=n!==s?n:f.searchFields,$.isArray(n)||(n=[n]),t===s||t===!1?(T.error(b.source),[]):($.each(n,function(s,n){$.each(t,function(t,s){var a="string"==typeof s[n];a&&(s[n].search(o)!==-1?c(r,s):f.searchFullText&&T.fuzzySearch(e,s[n])&&c(i,s))})}),$.merge(r,i))}},fuzzySearch:function(e,t){var s=t.length,n=e.length;if("string"!=typeof e)return!1;if(e=e.toLowerCase(),t=t.toLowerCase(),n>s)return!1;if(n===s)return e===t;e:for(var r=0,i=0;r<n;r++){for(var a=e.charCodeAt(r);i<s;)if(t.charCodeAt(i++)===a)continue e;return!1}return!0},parse:{response:function(e,t){var n=T.generateResults(e);T.verbose("Parsing server response",e),e!==s&&t!==s&&e[v.results]!==s&&(T.addResults(n),T.inject.id(e[v.results]),T.write.cache(t,{html:n,results:e[v.results]}),T.save.results(e[v.results]))}},cancel:{query:function(){T.can.useAPI()&&w.api("abort")}},has:{minimumCharacters:function(){var e=T.get.value(),t=e.length;return t>=f.minCharacters}},clear:{cache:function(e){var t=w.data(h.cache);e?e&&t&&t[e]&&(T.debug("Removing value from cache",e),delete t[e],w.data(h.cache,t)):(T.debug("Clearing cache",e),w.removeData(h.cache))}},read:{cache:function(e){var t=w.data(h.cache);return!!f.cache&&(T.verbose("Checking cache for generated html for query",e),"object"==typeof t&&t[e]!==s&&t[e])}},create:{id:function(e,t){var n=e+1,r=t+1,i,a,o;return t!==s?(a=String.fromCharCode(97+t),o=a+n,T.verbose("Creating category result id",o)):(o=n,T.verbose("Creating result id",o)),o},results:function(){0===k.length&&(k=$("<div />").addClass(g.results).appendTo(w))}},inject:{result:function(e,t,n){T.verbose("Injecting result into results");var r=n!==s?k.children().eq(n).children(m.result).eq(t):k.children(m.result).eq(t);T.verbose("Injecting results metadata",r),r.data(h.result,e)},id:function(e){T.debug("Injecting unique ids into results");var t=0,n=0;return"category"===f.type?$.each(e,function(e,r){n=0,$.each(r.results,function(e,i){var a=r.results[e];a.id===s&&(a.id=T.create.id(n,t)),T.inject.result(a,n,t),n++}),t++}):$.each(e,function(t,r){var i=e[t];i.id===s&&(i.id=T.create.id(n)),T.inject.result(i,n),n++}),e}},save:{results:function(e){T.verbose("Saving current search results to metadata",e),w.data(h.results,e)}},write:{cache:function(e,t){var n=w.data(h.cache)!==s?w.data(h.cache):{};f.cache&&(T.verbose("Writing generated html to cache",e,t),n[e]=t,w.data(h.cache,n))}},addResults:function(e){return $.isFunction(f.onResultsAdd)&&f.onResultsAdd.call(k,e)===!1?(T.debug("onResultsAdd callback cancelled default action"),!1):void(e?(k.html(e),T.refreshResults(),f.selectFirstResult&&T.select.firstResult(),T.showResults()):T.hideResults())},showResults:function(){T.is.visible()||(T.can.transition()?(T.debug("Showing results with css animations"),k.transition({animation:f.transition+" in",debug:f.debug,verbose:f.verbose,duration:f.duration,queue:!0})):(T.debug("Showing results with javascript"),k.stop().fadeIn(f.duration,f.easing)),f.onResultsOpen.call(k))},hideResults:function(){T.is.visible()&&(T.can.transition()?(T.debug("Hiding results with css animations"),k.transition({animation:f.transition+" out",debug:f.debug,verbose:f.verbose,duration:f.duration,queue:!0})):(T.debug("Hiding results with javascript"),k.stop().fadeOut(f.duration,f.easing)),f.onResultsClose.call(k))},generateResults:function(e){T.debug("Generating html from response",e);var t=f.templates[f.type],s=$.isPlainObject(e[v.results])&&!$.isEmptyObject(e[v.results]),n=$.isArray(e[v.results])&&e[v.results].length>0,r="";return s||n?(f.maxResults>0&&(s?"standard"==f.type&&T.error(b.maxResults):e[v.results]=e[v.results].slice(0,f.maxResults)),$.isFunction(t)?r=t(e,v):T.error(b.noTemplate,!1)):f.showNoResults&&(r=T.displayMessage(b.noResults,"empty")),f.onResults.call(q,e),r},displayMessage:function(e,t){return t=t||"standard",T.debug("Displaying message",e,t),T.addResults(f.templates.message(e,t)),f.templates.message(e,t)},setting:function(e,t){if($.isPlainObject(e))$.extend(!0,f,e);else{if(t===s)return f[e];f[e]=t}},internal:function(e,t){if($.isPlainObject(e))$.extend(!0,T,e);else{if(t===s)return T[e];T[e]=t}},debug:function(){!f.silent&&f.debug&&(f.performance?T.performance.log(arguments):(T.debug=Function.prototype.bind.call(console.info,console,f.name+":"),T.debug.apply(console,arguments)))},verbose:function(){!f.silent&&f.verbose&&f.debug&&(f.performance?T.performance.log(arguments):(T.verbose=Function.prototype.bind.call(console.info,console,f.name+":"),T.verbose.apply(console,arguments)))},error:function(){f.silent||(T.error=Function.prototype.bind.call(console.error,console,f.name+":"),T.error.apply(console,arguments))},performance:{log:function(e){var t,s,n;f.performance&&(t=(new Date).getTime(),n=a||t,s=t-n,a=t,o.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:q,"Execution Time":s})),clearTimeout(T.performance.timer),T.performance.timer=setTimeout(T.performance.display,500)},display:function(){var e=f.name+":",t=0;a=!1,clearTimeout(T.performance.timer),$.each(o,function(e,s){t+=s["Execution Time"]}),e+=" "+t+"ms",i&&(e+=" '"+i+"'"),r.length>1&&(e+=" ("+r.length+")"),(console.group!==s||console.table!==s)&&o.length>0&&(console.groupCollapsed(e),console.table?console.table(o):$.each(o,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),o=[]}},invoke:function(e,t,n){var r=F,i,a,o;return t=t||l,n=q||n,"string"==typeof e&&r!==s&&(e=e.split(/[\. ]/),i=e.length-1,$.each(e,function(t,n){var o=t!=i?n+e[t+1].charAt(0).toUpperCase()+e[t+1].slice(1):e;if($.isPlainObject(r[o])&&t!=i)r=r[o];else{if(r[o]!==s)return a=r[o],!1;if(!$.isPlainObject(r[n])||t==i)return r[n]!==s&&(a=r[n],!1);r=r[n]}})),$.isFunction(a)?o=a.apply(n,t):a!==s&&(o=a),$.isArray(d)?d.push(o):d!==s?d=[d,o]:o!==s&&(d=o),a}},u?(F===s&&T.initialize(),T.invoke(c)):(F!==s&&F.invoke("destroy"),T.initialize())}),d!==s?d:this},$.fn.search.settings={name:"Search",namespace:"search",silent:!1,debug:!1,verbose:!1,performance:!0,type:"standard",minCharacters:1,selectFirstResult:!1,apiSettings:!1,source:!1,searchFields:["title","description"],displayField:"",searchFullText:!0,automatic:!0,hideDelay:0,searchDelay:200,maxResults:7,cache:!0,showNoResults:!0,transition:"scale",duration:200,easing:"easeOutExpo",onSelect:!1,onResultsAdd:!1,onSearchQuery:function(e){},onResults:function(e){},onResultsOpen:function(){},onResultsClose:function(){},className:{animating:"animating",active:"active",empty:"empty",focus:"focus",hidden:"hidden",loading:"loading",results:"results",pressed:"down"},error:{source:"Cannot search. No source used, and Semantic API module was not included",noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noEndpoint:"No search endpoint was specified",noTemplate:"A valid template name was not specified.",serverError:"There was an issue querying the server.",maxResults:"Results must be an array to use maxResults setting",method:"The method you called is not defined."},metadata:{cache:"cache",results:"results",result:"result"},regExp:{escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,beginsWith:"(?:s|^)"},fields:{categories:"results",categoryName:"name",categoryResults:"results",description:"description",image:"image",price:"price",results:"results",title:"title",url:"url",action:"action",actionText:"text",actionURL:"url"},selector:{prompt:".prompt",searchButton:".search.button",results:".results",message:".results > .message",category:".category",result:".result",title:".title, .name"},templates:{escape:function(e){var t=/[&<>"'`]/g,s=/[&<>"'`]/,n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},r=function(e){return n[e]};return s.test(e)?e.replace(t,r):e},message:function(e,t){var n="";return e!==s&&t!==s&&(n+='<div class="message '+t+'">',n+="empty"==t?'<div class="header">No Results</div class="header"><div class="description">'+e+'</div class="description">':' <div class="description">'+e+"</div>",n+="</div>"),n},category:function(e,t){var n="",r=$.fn.search.settings.templates.escape;return e[t.categoryResults]!==s&&($.each(e[t.categoryResults],function(e,r){r[t.results]!==s&&r.results.length>0&&(n+='<div class="category">',r[t.categoryName]!==s&&(n+='<div class="name">'+r[t.categoryName]+"</div>"),$.each(r.results,function(e,r){n+=r[t.url]?'<a class="result" href="'+r[t.url]+'">':'<a class="result">',r[t.image]!==s&&(n+='<div class="image"> <img src="'+r[t.image]+'"></div>'),n+='<div class="content">',r[t.price]!==s&&(n+='<div class="price">'+r[t.price]+"</div>"),r[t.title]!==s&&(n+='<div class="title">'+r[t.title]+"</div>"),r[t.description]!==s&&(n+='<div class="description">'+r[t.description]+"</div>"),n+="</div>",n+="</a>"}),n+="</div>")}),e[t.action]&&(n+='<a href="'+e[t.action][t.actionURL]+'" class="action">'+e[t.action][t.actionText]+"</a>"),n)},standard:function(e,t){var n="";return e[t.results]!==s&&($.each(e[t.results],function(e,r){n+=r[t.url]?'<a class="result" href="'+r[t.url]+'">':'<a class="result">',r[t.image]!==s&&(n+='<div class="image"> <img src="'+r[t.image]+'"></div>'),n+='<div class="content">',r[t.price]!==s&&(n+='<div class="price">'+r[t.price]+"</div>"),r[t.title]!==s&&(n+='<div class="title">'+r[t.title]+"</div>"),r[t.description]!==s&&(n+='<div class="description">'+r[t.description]+"</div>"),n+="</div>",n+="</a>"}),e[t.action]&&(n+='<a href="'+e[t.action][t.actionURL]+'" class="action">'+e[t.action][t.actionText]+"</a>"),n)}}}}(jQuery,window,document);